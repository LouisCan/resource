---
title: Docker网络基础：快速指南
date: 2017-07-30 22:57:04
tags: 网络
categories: 大数据
thumbnail: http://osewdhh4j.bkt.clouddn.com/20170731165436.png
keywords: Docker网络基础,Docker
description: 了解有关扩展网络功能的默认Docker网络设置和选项。网络管理员不再拥有配置物理路由器，交换机和其他LAN/WAN组件的舒适区域。我们现在生活在一个虚拟化世界中，管理员必须挖掘VMware，Microsoft，Red Hat等虚拟化平台中的网络组件。
---


## Docker网络基础：快速指南

![](http://osewdhh4j.bkt.clouddn.com/20170731165436.png)

**了解有关扩展网络功能的默认Docker网络设置和选项。**

网络管理员不再拥有配置物理路由器，交换机和其他LAN / WAN组件的舒适区域。我们现在生活在一个虚拟化世界中，管理员必须挖掘VMware，Microsoft，Red Hat等虚拟化平台中的网络组件。

今天，企业IT 对容器越来越感兴趣，这些容器需要强大的网络技能才能正确配置容器架构。在本文中，我将重点介绍Docker的网络基础，轻松实现最受欢迎的容器平台。我将探讨默认的Docker网络设置，并解释Docker的用户定义配置选项如何提供扩展的网络功能。

### 默认Docker网络

最初安装Docker时，平台会自动配置三个名为none，host和bridge的不同网络。无法和主机网络无法删除; 它们是Docker中网络堆栈的一部分，但由于没有要配置的外部接口，对网络管理员无效。管理员可以配置桥接网络，也称为docker0网络。该网络自动创建IP子网和网关。属于该网络的所有容器都是同一子网的一部分，因此通过IP寻址可以在该网络中的容器之间进行通信。

然而，默认网桥的缺点是不支持使用DNS对容器进行自动服务发现。因此，如果希望属于默认网络的容器能够相互通信，则必须使用--link选项来静态地允许通信发生。另外，通信需要容器之间的端口转发。

许多管理员发现这些限制严重限制了Docker的网络可用性和可扩展性。这就是为什么创建用户定义的网络更好？它们可以更容易地管理需要彼此通信的容器。

### 用户定义网络的类型

除了在Docker中自动创建的默认网络之外，管理员还可以配置多个用户定义的网络，并将容器添加到一个或多个这样的网络。重要的是要注意，当容器属于同一个网络时，容器可以与他人通信，但不允许网络之间的通信。可能存在容器需要在多个网络中与其他人通信的情况。要解决这个问题，您只需将该容器添加到多个网络。然后，容器可以与其所关联的所有网络中的容器进行通信。

有三种主要类型的用户定义网络用于不同的通信目的：

**桥接网络** - 与默认网桥一样，用户定义的网桥是一个独立的IP子网和网关。但与默认网桥不同，用户定义的网桥内的所有容器都可以直接相互通信，无需端口转发。此外，该网络完全支持使用DNS进行自动发现。如果您希望其他网络中的其他设备与用户定义的桥接网络中的资源进行通信，则只需发布所需的TCP / UDP端口，Docker会将网络地址和端口公开到外部网络。

**覆盖网络** - 如果您打算在分布式网络中运行Docker，并且需要不同主机上的容器才能够直接相互通信，则覆盖网络是正确的选择。为此，您的Docker服务器必须启用群组模式并加入相同的群集。Swarm模式是Docker的一种允许管理Docker引擎集群的方法，称为“群集”。一旦完成，您可以使用VXLAN封装方案在群集中创建一个第2层覆盖网络。当容器被添加到覆盖网络时，它们可以直接与所有其他容器通信，就像它们驻留在同一个节点上一样。允许从外部网络到覆盖网络的通信与用户定义的网络网络类似。

![](http://osewdhh4j.bkt.clouddn.com/20170731165152.png)

**Macvlan网络** - 此用户定义的网络类型尝试通过在使用网桥和覆盖网络时消除驻留在容器和主机之间的桥接来简化和简化容器通信。这里的主要优点是它自动将外部容器资源暴露给外部网络，而无需处理端口转发。Macvlan网络通过使用第2层MAC地址而不是第3层IP寻址来实现这一点。


有三种不同的方式来设置Macvlan网络。首先是Macvlan桥模式。在此模式下，每个容器都分配有自己唯一的MAC地址。然后，Docker管理MAC地址到端口映射。在同一Macvlan桥网络内的容器之间的通信在第2层进行切换。Macvlan网桥之外的通信在第3层进行路由。

Macvlan 802.1q中继桥模式允许使用IEEE 802.1q标准中继规范标记不同的第2层VLAN，以分离容器。Docker主机可以配置为外部路由器和交换机的802.1q中继。然后，它通过VLAN分段容器，它们代表单独的网络子网。

如果您在使用IPv4和IPv6寻址的网络中运行Docker容器，则可以利用双栈Macvlan桥接模式。默认情况下，Docker仅在IPv4模式下运行。使用双栈Macvlan网桥，您可以同时使用两个版本的IP协议路由容器。

